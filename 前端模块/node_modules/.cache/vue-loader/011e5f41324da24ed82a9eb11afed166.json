{"remainingRequest":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue","mtime":1748095301103},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1748024889641},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\babel-loader\\lib\\index.js","mtime":1748024878556},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1748024889641},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js","mtime":1748024878761}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdVc2VyQXZhdGFyJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdGVkRmlsZTogbnVsbCwKICAgICAgcHJldmlld1VybDogJycsCiAgICAgIHVwbG9hZGluZzogZmFsc2UKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZShbJ3VzZXInXSksCiAgICAKICAgIC8vIOiOt+WPlueUqOaIt+WktOWDj1VSTAogICAgYXZhdGFyVXJsKCkgewogICAgICByZXR1cm4gdGhpcy51c2VyPy5hdmF0YXJVcmwgfHwgJycKICAgIH0sCiAgICAKICAgIC8vIOiOt+WPlueUqOaIt+WQjemmluWtl+avje+8iOaXoOWktOWDj+aXtuaYvuekuu+8iQogICAgdXNlckluaXRpYWxzKCkgewogICAgICBpZiAoIXRoaXMudXNlciB8fCAhdGhpcy51c2VyLnVzZXJuYW1lKSByZXR1cm4gJz8nCiAgICAgIHJldHVybiB0aGlzLnVzZXIudXNlcm5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOaYvuekuuS4iuS8oOWvueivneahhgogICAgc2hvd1VwbG9hZERpYWxvZygpIHsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICB0aGlzLnByZXZpZXdVcmwgPSB0aGlzLmF2YXRhclVybAogICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGwKICAgIH0sCiAgICAKICAgIC8vIOinpuWPkeaWh+S7tumAieaLqQogICAgdHJpZ2dlckZpbGVJbnB1dCgpIHsKICAgICAgdGhpcy4kcmVmcy5maWxlSW5wdXQuY2xpY2soKQogICAgfSwKICAgIAogICAgLy8g5aSE55CG5paH5Lu26YCJ5oupCiAgICBoYW5kbGVGaWxlQ2hhbmdlKGV2ZW50KSB7CiAgICAgIGNvbnN0IGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzCiAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgZmlsZSA9IGZpbGVzWzBdCiAgICAgICAgCiAgICAgICAgLy8g5qOA5p+l5paH5Lu257G75Z6LCiAgICAgICAgaWYgKCFmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+mAieaLqeWbvueJh+aWh+S7ticpCiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8g5qOA5p+l5paH5Lu25aSn5bCP77yIMk1C6ZmQ5Yi277yJCiAgICAgICAgaWYgKGZpbGUuc2l6ZSA+IDIgKiAxMDI0ICogMTAyNCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Zu+54mH5aSn5bCP5LiN6IO96LaF6L+HMk1CJykKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAKICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IGZpbGUKICAgICAgICAKICAgICAgICAvLyDliJvlu7rpooTop4gKICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgICB0aGlzLnByZXZpZXdVcmwgPSBlLnRhcmdldC5yZXN1bHQKICAgICAgICB9CiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgICAgfQogICAgfSwKICAgIAogICAgLy8g5LiK5Lyg5aS05YOPCiAgICBhc3luYyB1cGxvYWRBdmF0YXIoKSB7CiAgICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbGUpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+WFiOmAieaLqeWbvueJhycpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgCiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCkKICAgICAgZm9ybURhdGEuYXBwZW5kKCdhdmF0YXInLCB0aGlzLnNlbGVjdGVkRmlsZSkKICAgICAgCiAgICAgIHRoaXMudXBsb2FkaW5nID0gdHJ1ZQogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnL2FwaS91c2VyL2F2YXRhcicsIGZvcm1EYXRhLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIAogICAgICAgIC8vIOabtOaWsFZ1ZXjkuK3nmoTnlKjmiLfkv6Hmga8KICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFVzZXInLCB7CiAgICAgICAgICAuLi50aGlzLnVzZXIsCiAgICAgICAgICBhdmF0YXJVcmw6IHJlc3BvbnNlLmRhdGEuYXZhdGFyVXJsCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WktOWDj+S4iuS8oOaIkOWKnycpCiAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGDkuIrkvKDlpLHotKU6ICR7ZXJyb3IucmVzcG9uc2U/LmRhdGE/LmVycm9yIHx8ICfmnKrnn6XplJnor68nfWApCiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcikKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLnVwbG9hZGluZyA9IGZhbHNlCiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["UserAvatar.vue"],"names":[],"mappings":";AAwCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserAvatar.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"avatar-component\">\n    <div class=\"avatar-display\">\n      <img v-if=\"avatarUrl\" :src=\"avatarUrl\" class=\"avatar-image\" alt=\"用户头像\" />\n      <div v-else class=\"avatar-placeholder\">\n        <span>{{ userInitials }}</span>\n      </div>\n    </div>\n    \n    <div class=\"avatar-actions\">\n      <el-button type=\"primary\" size=\"small\" @click=\"showUploadDialog\">更换头像</el-button>\n    </div>\n    \n    <!-- 头像上传对话框 -->\n    <el-dialog title=\"更换头像\" :visible.sync=\"dialogVisible\" width=\"400px\">\n      <div class=\"upload-container\">\n        <div class=\"avatar-preview\">\n          <img v-if=\"previewUrl\" :src=\"previewUrl\" class=\"preview-image\" />\n          <div v-else class=\"preview-placeholder\">\n            <span>请选择图片</span>\n          </div>\n        </div>\n        \n        <div class=\"upload-actions\">\n          <input type=\"file\" ref=\"fileInput\" @change=\"handleFileChange\" accept=\"image/*\" style=\"display: none\" />\n          <el-button type=\"primary\" @click=\"triggerFileInput\" :disabled=\"uploading\">选择图片</el-button>\n          <el-button type=\"success\" @click=\"uploadAvatar\" :loading=\"uploading\" :disabled=\"!selectedFile\">\n            上传头像\n          </el-button>\n        </div>\n        \n        <div class=\"upload-tips\">\n          <p>支持JPG、PNG格式，文件不超过2MB</p>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { mapState } from 'vuex'\n\nexport default {\n  name: 'UserAvatar',\n  data() {\n    return {\n      dialogVisible: false,\n      selectedFile: null,\n      previewUrl: '',\n      uploading: false\n    }\n  },\n  computed: {\n    ...mapState(['user']),\n    \n    // 获取用户头像URL\n    avatarUrl() {\n      return this.user?.avatarUrl || ''\n    },\n    \n    // 获取用户名首字母（无头像时显示）\n    userInitials() {\n      if (!this.user || !this.user.username) return '?'\n      return this.user.username.charAt(0).toUpperCase()\n    }\n  },\n  methods: {\n    // 显示上传对话框\n    showUploadDialog() {\n      this.dialogVisible = true\n      this.previewUrl = this.avatarUrl\n      this.selectedFile = null\n    },\n    \n    // 触发文件选择\n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    // 处理文件选择\n    handleFileChange(event) {\n      const files = event.target.files\n      if (files.length > 0) {\n        const file = files[0]\n        \n        // 检查文件类型\n        if (!file.type.startsWith('image/')) {\n          this.$message.error('请选择图片文件')\n          return\n        }\n        \n        // 检查文件大小（2MB限制）\n        if (file.size > 2 * 1024 * 1024) {\n          this.$message.error('图片大小不能超过2MB')\n          return\n        }\n        \n        this.selectedFile = file\n        \n        // 创建预览\n        const reader = new FileReader()\n        reader.onload = (e) => {\n          this.previewUrl = e.target.result\n        }\n        reader.readAsDataURL(file)\n      }\n    },\n    \n    // 上传头像\n    async uploadAvatar() {\n      if (!this.selectedFile) {\n        this.$message.warning('请先选择图片')\n        return\n      }\n      \n      const formData = new FormData()\n      formData.append('avatar', this.selectedFile)\n      \n      this.uploading = true\n      try {\n        const response = await axios.post('/api/user/avatar', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n        \n        // 更新Vuex中的用户信息\n        this.$store.commit('setUser', {\n          ...this.user,\n          avatarUrl: response.data.avatarUrl\n        })\n        \n        this.$message.success('头像上传成功')\n        this.dialogVisible = false\n      } catch (error) {\n        this.$message.error(`上传失败: ${error.response?.data?.error || '未知错误'}`)\n        console.error(error)\n      } finally {\n        this.uploading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.avatar-component {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-display {\n  margin-bottom: 10px;\n}\n\n.avatar-image {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.avatar-placeholder {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  background-color: #409eff;\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 36px;\n  font-weight: bold;\n}\n\n.upload-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-preview {\n  margin-bottom: 20px;\n}\n\n.preview-image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.preview-placeholder {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  background-color: #f5f7fa;\n  border: 2px dashed #dcdfe6;\n  color: #909399;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.upload-actions {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 15px;\n}\n\n.upload-tips {\n  color: #909399;\n  font-size: 12px;\n}\n</style>\n"]}]}