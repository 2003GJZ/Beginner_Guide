{"remainingRequest":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue?vue&type=style&index=0&id=6bc76598&scoped=true&lang=css","dependencies":[{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue","mtime":1748095301103},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\css-loader\\dist\\cjs.js","mtime":1748024887609},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1748024879016},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\postcss-loader\\src\\index.js","mtime":1748024887367},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1748024889641},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js","mtime":1748024878761}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5hdmF0YXItY29tcG9uZW50IHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLmF2YXRhci1kaXNwbGF5IHsKICBtYXJnaW4tYm90dG9tOiAxMHB4Owp9CgouYXZhdGFyLWltYWdlIHsKICB3aWR0aDogMTAwcHg7CiAgaGVpZ2h0OiAxMDBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgb2JqZWN0LWZpdDogY292ZXI7CiAgYm9yZGVyOiAycHggc29saWQgI2RjZGZlNjsKfQoKLmF2YXRhci1wbGFjZWhvbGRlciB7CiAgd2lkdGg6IDEwMHB4OwogIGhlaWdodDogMTAwcHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGJhY2tncm91bmQtY29sb3I6ICM0MDllZmY7CiAgY29sb3I6IHdoaXRlOwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBmb250LXNpemU6IDM2cHg7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCi51cGxvYWQtY29udGFpbmVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLmF2YXRhci1wcmV2aWV3IHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgoucHJldmlldy1pbWFnZSB7CiAgd2lkdGg6IDE1MHB4OwogIGhlaWdodDogMTUwcHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIG9iamVjdC1maXQ6IGNvdmVyOwogIGJvcmRlcjogMnB4IHNvbGlkICNkY2RmZTY7Cn0KCi5wcmV2aWV3LXBsYWNlaG9sZGVyIHsKICB3aWR0aDogMTUwcHg7CiAgaGVpZ2h0OiAxNTBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjdmYTsKICBib3JkZXI6IDJweCBkYXNoZWQgI2RjZGZlNjsKICBjb2xvcjogIzkwOTM5OTsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi51cGxvYWQtYWN0aW9ucyB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDEwcHg7CiAgbWFyZ2luLWJvdHRvbTogMTVweDsKfQoKLnVwbG9hZC10aXBzIHsKICBjb2xvcjogIzkwOTM5OTsKICBmb250LXNpemU6IDEycHg7Cn0K"},{"version":3,"sources":["UserAvatar.vue"],"names":[],"mappings":";AAmJA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"UserAvatar.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"avatar-component\">\n    <div class=\"avatar-display\">\n      <img v-if=\"avatarUrl\" :src=\"avatarUrl\" class=\"avatar-image\" alt=\"用户头像\" />\n      <div v-else class=\"avatar-placeholder\">\n        <span>{{ userInitials }}</span>\n      </div>\n    </div>\n    \n    <div class=\"avatar-actions\">\n      <el-button type=\"primary\" size=\"small\" @click=\"showUploadDialog\">更换头像</el-button>\n    </div>\n    \n    <!-- 头像上传对话框 -->\n    <el-dialog title=\"更换头像\" :visible.sync=\"dialogVisible\" width=\"400px\">\n      <div class=\"upload-container\">\n        <div class=\"avatar-preview\">\n          <img v-if=\"previewUrl\" :src=\"previewUrl\" class=\"preview-image\" />\n          <div v-else class=\"preview-placeholder\">\n            <span>请选择图片</span>\n          </div>\n        </div>\n        \n        <div class=\"upload-actions\">\n          <input type=\"file\" ref=\"fileInput\" @change=\"handleFileChange\" accept=\"image/*\" style=\"display: none\" />\n          <el-button type=\"primary\" @click=\"triggerFileInput\" :disabled=\"uploading\">选择图片</el-button>\n          <el-button type=\"success\" @click=\"uploadAvatar\" :loading=\"uploading\" :disabled=\"!selectedFile\">\n            上传头像\n          </el-button>\n        </div>\n        \n        <div class=\"upload-tips\">\n          <p>支持JPG、PNG格式，文件不超过2MB</p>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { mapState } from 'vuex'\n\nexport default {\n  name: 'UserAvatar',\n  data() {\n    return {\n      dialogVisible: false,\n      selectedFile: null,\n      previewUrl: '',\n      uploading: false\n    }\n  },\n  computed: {\n    ...mapState(['user']),\n    \n    // 获取用户头像URL\n    avatarUrl() {\n      return this.user?.avatarUrl || ''\n    },\n    \n    // 获取用户名首字母（无头像时显示）\n    userInitials() {\n      if (!this.user || !this.user.username) return '?'\n      return this.user.username.charAt(0).toUpperCase()\n    }\n  },\n  methods: {\n    // 显示上传对话框\n    showUploadDialog() {\n      this.dialogVisible = true\n      this.previewUrl = this.avatarUrl\n      this.selectedFile = null\n    },\n    \n    // 触发文件选择\n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    // 处理文件选择\n    handleFileChange(event) {\n      const files = event.target.files\n      if (files.length > 0) {\n        const file = files[0]\n        \n        // 检查文件类型\n        if (!file.type.startsWith('image/')) {\n          this.$message.error('请选择图片文件')\n          return\n        }\n        \n        // 检查文件大小（2MB限制）\n        if (file.size > 2 * 1024 * 1024) {\n          this.$message.error('图片大小不能超过2MB')\n          return\n        }\n        \n        this.selectedFile = file\n        \n        // 创建预览\n        const reader = new FileReader()\n        reader.onload = (e) => {\n          this.previewUrl = e.target.result\n        }\n        reader.readAsDataURL(file)\n      }\n    },\n    \n    // 上传头像\n    async uploadAvatar() {\n      if (!this.selectedFile) {\n        this.$message.warning('请先选择图片')\n        return\n      }\n      \n      const formData = new FormData()\n      formData.append('avatar', this.selectedFile)\n      \n      this.uploading = true\n      try {\n        const response = await axios.post('/api/user/avatar', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n        \n        // 更新Vuex中的用户信息\n        this.$store.commit('setUser', {\n          ...this.user,\n          avatarUrl: response.data.avatarUrl\n        })\n        \n        this.$message.success('头像上传成功')\n        this.dialogVisible = false\n      } catch (error) {\n        this.$message.error(`上传失败: ${error.response?.data?.error || '未知错误'}`)\n        console.error(error)\n      } finally {\n        this.uploading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.avatar-component {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-display {\n  margin-bottom: 10px;\n}\n\n.avatar-image {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.avatar-placeholder {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  background-color: #409eff;\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 36px;\n  font-weight: bold;\n}\n\n.upload-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-preview {\n  margin-bottom: 20px;\n}\n\n.preview-image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.preview-placeholder {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  background-color: #f5f7fa;\n  border: 2px dashed #dcdfe6;\n  color: #909399;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.upload-actions {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 15px;\n}\n\n.upload-tips {\n  color: #909399;\n  font-size: 12px;\n}\n</style>\n"]}]}