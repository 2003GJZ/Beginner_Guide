{"remainingRequest":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\babel-loader\\lib\\index.js!D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\src\\components\\UserAvatar.vue","mtime":1748095301103},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\babel.config.js","mtime":1748026455161},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1748024889641},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\babel-loader\\lib\\index.js","mtime":1748024878556},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1748024889641},{"path":"D:\\大水管子\\Beginner_Guide\\前端模块\\node_modules\\vue-loader\\lib\\index.js","mtime":1748024878761}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdVc2VyQXZhdGFyJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdGVkRmlsZTogbnVsbCwKICAgICAgcHJldmlld1VybDogJycsCiAgICAgIHVwbG9hZGluZzogZmFsc2UKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoWyd1c2VyJ10pLAogICAgLy8g6I635Y+W55So5oi35aS05YOPVVJMCiAgICBhdmF0YXJVcmwoKSB7CiAgICAgIHZhciBfdGhpcyR1c2VyOwogICAgICByZXR1cm4gKChfdGhpcyR1c2VyID0gdGhpcy51c2VyKSA9PT0gbnVsbCB8fCBfdGhpcyR1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyR1c2VyLmF2YXRhclVybCkgfHwgJyc7CiAgICB9LAogICAgLy8g6I635Y+W55So5oi35ZCN6aaW5a2X5q+N77yI5peg5aS05YOP5pe25pi+56S677yJCiAgICB1c2VySW5pdGlhbHMoKSB7CiAgICAgIGlmICghdGhpcy51c2VyIHx8ICF0aGlzLnVzZXIudXNlcm5hbWUpIHJldHVybiAnPyc7CiAgICAgIHJldHVybiB0aGlzLnVzZXIudXNlcm5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDmmL7npLrkuIrkvKDlr7nor53moYYKICAgIHNob3dVcGxvYWREaWFsb2coKSB7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMucHJldmlld1VybCA9IHRoaXMuYXZhdGFyVXJsOwogICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGw7CiAgICB9LAogICAgLy8g6Kem5Y+R5paH5Lu26YCJ5oupCiAgICB0cmlnZ2VyRmlsZUlucHV0KCkgewogICAgICB0aGlzLiRyZWZzLmZpbGVJbnB1dC5jbGljaygpOwogICAgfSwKICAgIC8vIOWkhOeQhuaWh+S7tumAieaLqQogICAgaGFuZGxlRmlsZUNoYW5nZShldmVudCkgewogICAgICBjb25zdCBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlczsKICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07CgogICAgICAgIC8vIOajgOafpeaWh+S7tuexu+WeiwogICAgICAgIGlmICghZmlsZS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fpgInmi6nlm77niYfmlofku7YnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOajgOafpeaWh+S7tuWkp+Wwj++8iDJNQumZkOWItu+8iQogICAgICAgIGlmIChmaWxlLnNpemUgPiAyICogMTAyNCAqIDEwMjQpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WbvueJh+Wkp+Wwj+S4jeiDvei2hei/hzJNQicpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IGZpbGU7CgogICAgICAgIC8vIOWIm+W7uumihOiniAogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgICAgdGhpcy5wcmV2aWV3VXJsID0gZS50YXJnZXQucmVzdWx0OwogICAgICAgIH07CiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDkuIrkvKDlpLTlg48KICAgIGFzeW5jIHVwbG9hZEF2YXRhcigpIHsKICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRmlsZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+35YWI6YCJ5oup5Zu+54mHJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnYXZhdGFyJywgdGhpcy5zZWxlY3RlZEZpbGUpOwogICAgICB0aGlzLnVwbG9hZGluZyA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KCcvYXBpL3VzZXIvYXZhdGFyJywgZm9ybURhdGEsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyDmm7TmlrBWdWV45Lit55qE55So5oi35L+h5oGvCiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRVc2VyJywgewogICAgICAgICAgLi4udGhpcy51c2VyLAogICAgICAgICAgYXZhdGFyVXJsOiByZXNwb25zZS5kYXRhLmF2YXRhclVybAogICAgICAgIH0pOwogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5aS05YOP5LiK5Lyg5oiQ5YqfJyk7CiAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdmFyIF9lcnJvciRyZXNwb25zZTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGDkuIrkvKDlpLHotKU6ICR7KChfZXJyb3IkcmVzcG9uc2UgPSBlcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlID09PSB2b2lkIDAgfHwgKF9lcnJvciRyZXNwb25zZSA9IF9lcnJvciRyZXNwb25zZS5kYXRhKSA9PT0gbnVsbCB8fCBfZXJyb3IkcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnJvciRyZXNwb25zZS5lcnJvcikgfHwgJ+acquefpemUmeivryd9YCk7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy51cGxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0KfTs="},{"version":3,"names":["axios","mapState","name","data","dialogVisible","selectedFile","previewUrl","uploading","computed","avatarUrl","_this$user","user","userInitials","username","charAt","toUpperCase","methods","showUploadDialog","triggerFileInput","$refs","fileInput","click","handleFileChange","event","files","target","length","file","type","startsWith","$message","error","size","reader","FileReader","onload","e","result","readAsDataURL","uploadAvatar","warning","formData","FormData","append","response","post","headers","$store","commit","success","_error$response","console"],"sources":["src/components/UserAvatar.vue"],"sourcesContent":["<template>\n  <div class=\"avatar-component\">\n    <div class=\"avatar-display\">\n      <img v-if=\"avatarUrl\" :src=\"avatarUrl\" class=\"avatar-image\" alt=\"用户头像\" />\n      <div v-else class=\"avatar-placeholder\">\n        <span>{{ userInitials }}</span>\n      </div>\n    </div>\n    \n    <div class=\"avatar-actions\">\n      <el-button type=\"primary\" size=\"small\" @click=\"showUploadDialog\">更换头像</el-button>\n    </div>\n    \n    <!-- 头像上传对话框 -->\n    <el-dialog title=\"更换头像\" :visible.sync=\"dialogVisible\" width=\"400px\">\n      <div class=\"upload-container\">\n        <div class=\"avatar-preview\">\n          <img v-if=\"previewUrl\" :src=\"previewUrl\" class=\"preview-image\" />\n          <div v-else class=\"preview-placeholder\">\n            <span>请选择图片</span>\n          </div>\n        </div>\n        \n        <div class=\"upload-actions\">\n          <input type=\"file\" ref=\"fileInput\" @change=\"handleFileChange\" accept=\"image/*\" style=\"display: none\" />\n          <el-button type=\"primary\" @click=\"triggerFileInput\" :disabled=\"uploading\">选择图片</el-button>\n          <el-button type=\"success\" @click=\"uploadAvatar\" :loading=\"uploading\" :disabled=\"!selectedFile\">\n            上传头像\n          </el-button>\n        </div>\n        \n        <div class=\"upload-tips\">\n          <p>支持JPG、PNG格式，文件不超过2MB</p>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { mapState } from 'vuex'\n\nexport default {\n  name: 'UserAvatar',\n  data() {\n    return {\n      dialogVisible: false,\n      selectedFile: null,\n      previewUrl: '',\n      uploading: false\n    }\n  },\n  computed: {\n    ...mapState(['user']),\n    \n    // 获取用户头像URL\n    avatarUrl() {\n      return this.user?.avatarUrl || ''\n    },\n    \n    // 获取用户名首字母（无头像时显示）\n    userInitials() {\n      if (!this.user || !this.user.username) return '?'\n      return this.user.username.charAt(0).toUpperCase()\n    }\n  },\n  methods: {\n    // 显示上传对话框\n    showUploadDialog() {\n      this.dialogVisible = true\n      this.previewUrl = this.avatarUrl\n      this.selectedFile = null\n    },\n    \n    // 触发文件选择\n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    // 处理文件选择\n    handleFileChange(event) {\n      const files = event.target.files\n      if (files.length > 0) {\n        const file = files[0]\n        \n        // 检查文件类型\n        if (!file.type.startsWith('image/')) {\n          this.$message.error('请选择图片文件')\n          return\n        }\n        \n        // 检查文件大小（2MB限制）\n        if (file.size > 2 * 1024 * 1024) {\n          this.$message.error('图片大小不能超过2MB')\n          return\n        }\n        \n        this.selectedFile = file\n        \n        // 创建预览\n        const reader = new FileReader()\n        reader.onload = (e) => {\n          this.previewUrl = e.target.result\n        }\n        reader.readAsDataURL(file)\n      }\n    },\n    \n    // 上传头像\n    async uploadAvatar() {\n      if (!this.selectedFile) {\n        this.$message.warning('请先选择图片')\n        return\n      }\n      \n      const formData = new FormData()\n      formData.append('avatar', this.selectedFile)\n      \n      this.uploading = true\n      try {\n        const response = await axios.post('/api/user/avatar', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n        \n        // 更新Vuex中的用户信息\n        this.$store.commit('setUser', {\n          ...this.user,\n          avatarUrl: response.data.avatarUrl\n        })\n        \n        this.$message.success('头像上传成功')\n        this.dialogVisible = false\n      } catch (error) {\n        this.$message.error(`上传失败: ${error.response?.data?.error || '未知错误'}`)\n        console.error(error)\n      } finally {\n        this.uploading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.avatar-component {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-display {\n  margin-bottom: 10px;\n}\n\n.avatar-image {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.avatar-placeholder {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  background-color: #409eff;\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 36px;\n  font-weight: bold;\n}\n\n.upload-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.avatar-preview {\n  margin-bottom: 20px;\n}\n\n.preview-image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #dcdfe6;\n}\n\n.preview-placeholder {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  background-color: #f5f7fa;\n  border: 2px dashed #dcdfe6;\n  color: #909399;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.upload-actions {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 15px;\n}\n\n.upload-tips {\n  color: #909399;\n  font-size: 12px;\n}\n</style>\n"],"mappings":"AAwCA,OAAAA,KAAA;AACA,SAAAC,QAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,aAAA;MACAC,YAAA;MACAC,UAAA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACA,GAAAP,QAAA;IAEA;IACAQ,UAAA;MAAA,IAAAC,UAAA;MACA,SAAAA,UAAA,QAAAC,IAAA,cAAAD,UAAA,uBAAAA,UAAA,CAAAD,SAAA;IACA;IAEA;IACAG,aAAA;MACA,UAAAD,IAAA,UAAAA,IAAA,CAAAE,QAAA;MACA,YAAAF,IAAA,CAAAE,QAAA,CAAAC,MAAA,IAAAC,WAAA;IACA;EACA;EACAC,OAAA;IACA;IACAC,iBAAA;MACA,KAAAb,aAAA;MACA,KAAAE,UAAA,QAAAG,SAAA;MACA,KAAAJ,YAAA;IACA;IAEA;IACAa,iBAAA;MACA,KAAAC,KAAA,CAAAC,SAAA,CAAAC,KAAA;IACA;IAEA;IACAC,iBAAAC,KAAA;MACA,MAAAC,KAAA,GAAAD,KAAA,CAAAE,MAAA,CAAAD,KAAA;MACA,IAAAA,KAAA,CAAAE,MAAA;QACA,MAAAC,IAAA,GAAAH,KAAA;;QAEA;QACA,KAAAG,IAAA,CAAAC,IAAA,CAAAC,UAAA;UACA,KAAAC,QAAA,CAAAC,KAAA;UACA;QACA;;QAEA;QACA,IAAAJ,IAAA,CAAAK,IAAA;UACA,KAAAF,QAAA,CAAAC,KAAA;UACA;QACA;QAEA,KAAA1B,YAAA,GAAAsB,IAAA;;QAEA;QACA,MAAAM,MAAA,OAAAC,UAAA;QACAD,MAAA,CAAAE,MAAA,GAAAC,CAAA;UACA,KAAA9B,UAAA,GAAA8B,CAAA,CAAAX,MAAA,CAAAY,MAAA;QACA;QACAJ,MAAA,CAAAK,aAAA,CAAAX,IAAA;MACA;IACA;IAEA;IACA,MAAAY,aAAA;MACA,UAAAlC,YAAA;QACA,KAAAyB,QAAA,CAAAU,OAAA;QACA;MACA;MAEA,MAAAC,QAAA,OAAAC,QAAA;MACAD,QAAA,CAAAE,MAAA,gBAAAtC,YAAA;MAEA,KAAAE,SAAA;MACA;QACA,MAAAqC,QAAA,SAAA5C,KAAA,CAAA6C,IAAA,qBAAAJ,QAAA;UACAK,OAAA;YACA;UACA;QACA;;QAEA;QACA,KAAAC,MAAA,CAAAC,MAAA;UACA,QAAArC,IAAA;UACAF,SAAA,EAAAmC,QAAA,CAAAzC,IAAA,CAAAM;QACA;QAEA,KAAAqB,QAAA,CAAAmB,OAAA;QACA,KAAA7C,aAAA;MACA,SAAA2B,KAAA;QAAA,IAAAmB,eAAA;QACA,KAAApB,QAAA,CAAAC,KAAA,YAAAmB,eAAA,GAAAnB,KAAA,CAAAa,QAAA,cAAAM,eAAA,gBAAAA,eAAA,GAAAA,eAAA,CAAA/C,IAAA,cAAA+C,eAAA,uBAAAA,eAAA,CAAAnB,KAAA;QACAoB,OAAA,CAAApB,KAAA,CAAAA,KAAA;MACA;QACA,KAAAxB,SAAA;MACA;IACA;EACA;AACA","ignoreList":[]}]}